Основные структурные блоки и подходы
====================================

Данные
------
Для построения и оптимизации портфеля используются следующие основные источники данных:

* Котировки и вспомогательная биржевая информация
* Дивиденды
* Индекс потребительских цен

Данные из всех источников сохраняются в локальной базе на основе `Lightning Memory-Mapped Database
<https://en.wikipedia.org/wiki/Lightning_Memory-Mapped_Database>`_.

Котировки
^^^^^^^^^
Котировки и вспомогательная биржевая информация загружаются напрямую с `MOEX Informational &
Statistical Server <https://www.moex.com/a2193>`_ с использованием асинхронных вызовов, что позволяет
быстро скачать историю котировок по всем обращающимся на MOEX акциям и в последствии
инкрементально обновлять ее каждый торговый день после публикации финальных данных о торгах в 19:45.

Дивиденды
^^^^^^^^^
Данные по дивидендам загружаются из поддерживаемой в ручную базы данных на основе SQLite, которая
содержит информацию из ежеквартальных отчетов эмитентов о выплаченных дивидендах с 2010 года. Для
облегчения ручного обновления реализован ряд функция сверки с публичными источниками данных на сайтах:

* https://smart-lab.ru
* https://www.dohod.ru
* https://www.conomy.ru

Индекс потребительских цен
^^^^^^^^^^^^^^^^^^^^^^^^^^
Для построения ряда отчетов с корректировкой на рост цен используются данные по потребительской
инфляции с сайта `ФСГС <http://www.gks.ru>`_.

Оценка ковариации
-----------------
При оценке ковариационной матрицы для портфеля состоящего из n акций требуется оценить n * (n + 1) / 2
параметров. При большом количестве акций в портфеле количество оцениваемых параметров становится
достаточно большим по сравнению с объемом выборки, что делает получаемые оценки крайне неустойчивыми.
Одним из рекомендуемых в литературе подходов является использование сжатия к матрице с малым числом
оцениваемых параметров.

В составе библиотеки scikit-learn содержится реализация сжатия
`Ledoit & Wolf <https://scikit-learn.org/stable/modules/covariance.html#shrunk-covariance>`_. В качестве
целевой выступает матрица с одинаковой дисперсией и нулевой корреляцией, что не очень согласуется с
задачей оптимизации портфеля акций:

* Нулевая корреляция предполагает отсутствии систематического риска и возможность полной диверсификации портфеля - в реальности акции обычно имеют положительную корреляцию, а любой портфель акций имеет неустранимые систематические риски
* Акции имеют статистически значимо различающиеся дисперсии - привилегированные акции крупных компаний, которые выплачивают стабильные дивиденды, обычно имеют относительно невысокую дисперсию по сравнению с акциями мелких компаний или компаний, проходящих через серьезные корпоративные события (слияния, санкции и т.д.)

В данной реализации для оценки ковариационной матрицы используется асимптотически оптимальное сжатие к
матрице с разной дисперсией и одинаковой корреляцией на основе работы
`Ledoit & Wolf ("Honey, I shrunk the sample covariance matrix", Portfolio Management, 30(2004),
110-119) <http://www.ledoit.net/honey.pdf>`_ . Данный подход был
специально разработан для сжатия
ковариационных матриц портфелей акций.

Прогнозирование доходности
--------------------------

Прогнозирование доходности осуществляется с помощью библиотеки градиентного бустинга `Catboost
<https://catboost.ai>`_.
В качестве целевой переменной используется нормированная по локальной волатильности доходность для
компенсации разности волатильности отдельных акций и гетероскедастичности.
В качестве объясняющих факторов используется известные в академической литературе рыночные аномалии - за
основу взяты результаты из работы `Empirical Asset Pricing via Machine Learning <http://dachxiu.chicagobooth.edu/download/ML.pdf>`_.
Параметры расчета объясняющих факторов выбираются с помощью байесовской оптимизации с использованием
библиотеки `hyperopt <https://github.com/hyperopt/hyperopt>`_.

Оптимизация портфеля
--------------------
